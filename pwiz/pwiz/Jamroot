#
# Jamroot (pwiz) 
#
#
# Original author: Darren Kessner <Darren.Kessner@cshs.org>
#
# Copyright 2008 Spielberg Family Center for Applied Proteomics
#   Cedars-Sinai Medical Center, Los Angeles, California  90048
#
# Licensed under the Apache License, Version 2.0 (the "License"); 
# you may not use this file except in compliance with the License. 
# You may obtain a copy of the License at 
# 
# http://www.apache.org/licenses/LICENSE-2.0
# 
# Unless required by applicable law or agreed to in writing, software 
# distributed under the License is distributed on an "AS IS" BASIS, 
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. 
# See the License for the specific language governing permissions and 
# limitations under the License.
#


import testing ; # needed to enable unit-test rule


project pwiz 
    : requirements 
        <include>. 
        #<warnings-as-errors>on
        <warnings>all

        # is there any platform where static runtime linkage does not necessiate static object linkage?
        <runtime-link>static:<link>static

        # static runtime linking for gcc
        #<toolset>gcc:<runtime-link>static

        # special msvc hacks
        <toolset>msvc:<define>WIN32                     # windows
        <toolset>msvc:<define>_CRT_SECURE_NO_DEPRECATE  # don't deprecate the standard library 
        <toolset>msvc:<define>_SCL_SECURE_NO_DEPRECATE  # don't deprecate the standard library 
        <toolset>msvc:<define>_SECURE_SCL_THROWS=1      # checked iterators throw instead of crash  
        <toolset>msvc:<define>_USE_MATH_DEFINES         # for M_PI in <cmath>
        <toolset>msvc:<cxxflags>/wd4100                 # warning: unreferenced formal parameter
        <toolset>msvc:<cxxflags>/wd4512                 # warning: assignment operator could not be generated
        <toolset>msvc:<cxxflags>/wd4127                 # warning: conditional expression is constant (boost::lexical_cast)
        <toolset>msvc:<cxxflags>/wd4701                 # warning: potentially uninitialized local variable 'result' used (boost::lexical_cast, debug)
        <toolset>msvc:<cxxflags>/wd4245                 # warning: conversion from 'type1' to 'type2', signed/unsigned mismatch (boost/filesystem/convenience.hpp)
        <toolset>msvc:<cxxflags>/wd4251                 # warning: class needs to have dll-interface to be used by clients of class
        <toolset>msvc:<cxxflags>/wd4267					# warning: conversion from 'type1' to 'type2', possible loss of data (boost::lexical_cast)

        # special gcc hack - Cygwin gcc 3.4.4, Ubuntu gcc 4.1.2 
        # warning: '__cur' might be used uninitialized in this function 
        <toolset>gcc:<cxxflags>-Wno-uninitialized   

        # special Cygwin gcc-3.4.4 hack
        # linker "multiple definition" error on inclusion of boost-1.34.1 filesystem headers  
        <toolset>gcc-3.4.4:<linkflags>-Wl,--allow-multiple-definition

        # allow "long long" even with -pedantic
        <toolset>gcc:<cxxflags>-Wno-long-long
        <toolset>darwin:<cxxflags>-Wno-long-long

    : build-dir ../build
    : default-build release <link>static 
    ;


# external library declarations

lib pthread : : <link>shared ;
lib jpeg png z ;
lib gd : jpeg png z : <name>gd ;
lib gd : : <toolset>msvc <name>bgd <search>../libraries : : <include>../libraries/gd-2.0.33 ;

lib fftw3 ;
lib fftw3 : : <toolset>msvc <name>libfftw3-3 <search>../libraries : : <include>../libraries/fftw-3.1.2/api ;

#
# Boost libraries notes:
#
# For gcc, builds are <runtime-link>static.  To build the boost libraries with static
# runtime linking, use "bjam stage runtime-link=static" from the root of the Boost 
# distribution.  This will produce files with filenames like "libboost_filesystem-gcc41-mt-s.a".
# The declarations below use a shortened name, so you should either rename or use a symbolic
# link, and put in your library path:
#   ln -s libboost_filesystem-gcc41-mt-s libboost_filesystem-gcc.a
#
# msdata/cvgen requires boost::regex to be built with BOOST_REGEX_MATCH_EXTRA defined in 
# boost/regex/user.hpp
#

lib boost_filesystem : : <toolset>gcc <name>boost_filesystem ;
#lib boost_filesystem : : <toolset>msvc <variant>release <link>shared <runtime-link>shared <name>boost_filesystem-vc80-mt ;
lib boost_filesystem : : <toolset>msvc <variant>release  <runtime-link>shared <name>libboost_filesystem-vc80-mt ;
lib boost_filesystem : : <toolset>msvc <variant>release <link>static <runtime-link>static <name>libboost_filesystem-vc80-mt-s ;
#lib boost_filesystem : : <toolset>msvc <variant>debug <link>shared <runtime-link>shared <name>boost_filesystem-vc80-mt-gd ;
lib boost_filesystem : : <toolset>msvc <variant>debug  <runtime-link>shared <name>libboost_filesystem-vc80-mt-gd ;
lib boost_filesystem : : <toolset>msvc <variant>debug <link>static <runtime-link>static <name>libboost_filesystem-vc80-mt-sgd ;
lib boost_filesystem ;

lib boost_iostreams : : <toolset>gcc <name>boost_iostreams ;
#lib boost_iostreams : : <toolset>msvc <variant>release <link>shared <runtime-link>shared <name>boost_iostreams-vc80-mt ;
lib boost_iostreams : : <toolset>msvc <variant>release  <runtime-link>shared <name>libboost_iostreams-vc80-mt ;
lib boost_iostreams : : <toolset>msvc <variant>release <link>static <runtime-link>static <name>libboost_iostreams-vc80-mt-s ;
#lib boost_iostreams : : <toolset>msvc <variant>debug <link>shared <runtime-link>shared <name>boost_iostreams-vc80-mt-gd ;
lib boost_iostreams : : <toolset>msvc <variant>debug  <runtime-link>shared <name>libboost_iostreams-vc80-mt-gd ;
lib boost_iostreams : : <toolset>msvc <variant>debug <link>static <runtime-link>static <name>libboost_iostreams-vc80-mt-sgd ;
lib boost_iostreams ;

lib boost_program_options : : <toolset>gcc <name>boost_program_options ;
#lib boost_program_options : : <toolset>msvc <variant>release <link>shared <runtime-link>shared <name>boost_program_options-vc80-mt ;
lib boost_program_options : : <toolset>msvc <variant>release  <runtime-link>shared <name>libboost_program_options-vc80-mt ;
lib boost_program_options : : <toolset>msvc <variant>release <link>static <runtime-link>static <name>libboost_program_options-vc80-mt-s ;
#lib boost_program_options : : <toolset>msvc <variant>debug <link>shared <runtime-link>shared <name>boost_program_options-vc80-mt-gd ;
lib boost_program_options : : <toolset>msvc <variant>debug  <runtime-link>shared <name>libboost_program_options-vc80-mt-gd ;
lib boost_program_options : : <toolset>msvc <variant>debug <link>static <runtime-link>static <name>libboost_program_options-vc80-mt-sgd ;
lib boost_program_options ;

lib boost_serialization : : <toolset>gcc <name>boost_serialization ;
#lib boost_serialization : : <toolset>msvc <variant>release <link>shared <runtime-link>shared <name>boost_serialization-vc80-mt ;
lib boost_serialization : : <toolset>msvc <variant>release  <runtime-link>shared <name>libboost_serialization-vc80-mt ;
lib boost_serialization : : <toolset>msvc <variant>release <link>static <runtime-link>static <name>libboost_serialization-vc80-mt-s ;
#lib boost_serialization : : <toolset>msvc <variant>debug <link>shared <runtime-link>shared <name>boost_serialization-vc80-mt-gd ;
lib boost_serialization : : <toolset>msvc <variant>debug  <runtime-link>shared <name>libboost_serialization-vc80-mt-gd ;
lib boost_serialization : : <toolset>msvc <variant>debug <link>static <runtime-link>static <name>libboost_serialization-vc80-mt-sgd ;
lib boost_serialization ;

lib boost_regex : pthread : <toolset>gcc <name>boost_regex ;
#lib boost_regex : : <toolset>msvc <variant>release <link>shared <runtime-link>shared <name>boost_regex-vc80-mt ;
lib boost_regex : : <toolset>msvc <variant>release  <runtime-link>shared <name>libboost_regex-vc80-mt ;
lib boost_regex : : <toolset>msvc <variant>release <link>static <runtime-link>static <name>libboost_regex-vc80-mt-s ;
#lib boost_regex : : <toolset>msvc <variant>debug <link>shared <runtime-link>shared <name>boost_regex-vc80-mt-gd ;
lib boost_regex : : <toolset>msvc <variant>debug  <runtime-link>shared <name>libboost_regex-vc80-mt-gd ;
lib boost_regex : : <toolset>msvc <variant>debug <link>static <runtime-link>static <name>libboost_regex-vc80-mt-sgd ;
lib boost_regex ;

