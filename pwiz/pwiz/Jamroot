import testing ; # needed to enable unit-test rule


project pwiz 
    : requirements 
        <include>. 
        <warnings-as-errors>on

        # special msvc hacks
        <toolset>msvc:<define>WIN32                     # we love Windows! 
        <toolset>msvc:<define>_CRT_SECURE_NO_DEPRECATE  # get out of my face, Microsoft! 
        <toolset>msvc:<define>_SCL_SECURE_NO_DEPRECATE  # stop it! 
        <toolset>msvc:<define>_SECURE_SCL_THROWS=1      # checked iterators throw instead of crash  
        <toolset>msvc:<define>_USE_MATH_DEFINES         # for M_PI in <cmath>
        <toolset>msvc:<cxxflags>/wd4100                 # warning: unreferenced formal parameter
        <toolset>msvc:<cxxflags>/wd4512                 # warning: assignment operator could not be generated
        <toolset>msvc:<cxxflags>/wd4127                 # warning: conditional expression is constant (boost::lexical_cast)
        <toolset>msvc:<cxxflags>/wd4701                 # warning: potentially uninitialized local variable 'result' used (boost::lexical_cast, debug)
        <toolset>msvc:<cxxflags>/wd4245                 # warning: conversion from 'type1' to 'type2', signed/unsigned mismatch (boost/filesystem/convenience.hpp)

        # special gcc hack - Cygwin gcc 3.4.4, Ubuntu gcc 4.1.2 
        # warning: '__cur' might be used uninitialized in this function 
        <toolset>gcc:<cxxflags>-Wno-uninitialized   

        # special Cygwin gcc-3.4.4 hack
        # linker "multiple definition" error on inclusion of boost-1.34.1 filesystem headers  
        <toolset>gcc-3.4.4:<linkflags>-Wl,--allow-multiple-definition

        # allow "long long" even with -pedantic
        <toolset>gcc:<cxxflags>-Wno-long-long

    : build-dir ../build
    : default-build release <link>static <runtime-link>static
    ;


# external library declarations

lib jpeg png z pthread ;
lib gd : jpeg png z : <toolset>gcc <name>gd ;
lib gd : : <toolset>msvc <name>bgd ;

lib fftw3 ;
lib fftw3 : : <toolset>msvc <name>libfftw3-3 ;

lib boost_filesystem : : <toolset>gcc <name>boost_filesystem-gcc ;
lib boost_filesystem : : <toolset>gcc <runtime-link>static <name>boost_filesystem-gcc-mt-s ;
lib boost_filesystem : : <toolset>msvc <name>libboost_filesystem-vc80-mt ;
lib boost_filesystem : : <toolset>msvc <variant>debug <name>libboost_filesystem-vc80-mt-gd ;

lib boost_iostreams : : <toolset>gcc <name>boost_iostreams-gcc ;
lib boost_iostreams : : <toolset>gcc <runtime-link>static <name>boost_iostreams-gcc-mt-s ;
lib boost_iostreams : : <toolset>msvc <name>libboost_iostreams-vc80-mt ;
lib boost_iostreams : : <toolset>msvc <variant>debug <name>libboost_iostreams-vc80-mt-gd ;

lib boost_program_options : : <toolset>gcc <name>boost_program_options-gcc ;
lib boost_program_options : : <toolset>gcc <runtime-link>static <name>boost_program_options-gcc-mt-s ;
lib boost_program_options : : <toolset>msvc <name>libboost_program_options-vc80-mt ;
lib boost_program_options : : <toolset>msvc <variant>debug <name>libboost_program_options-vc80-mt-gd ;

lib boost_serialization : : <toolset>gcc <name>boost_serialization-gcc ;
lib boost_serialization : : <toolset>gcc <runtime-link>static <name>boost_serialization-gcc-mt-s ;
lib boost_serialization : : <toolset>msvc <name>libboost_serialization-vc80-mt ;
lib boost_serialization : : <toolset>msvc <variant>debug <name>libboost_serialization-vc80-mt-gd ;

lib boost_regex : pthread : <toolset>gcc <name>boost_regex-gcc ;
lib boost_regex : pthread : <toolset>gcc <runtime-link>static <name>boost_regex-gcc-mt-s ;
lib boost_regex : : <toolset>gcc <variant>debug <name>boost_regex-gcc-d ;
lib boost_regex : : <toolset>msvc <name>libboost_regex-vc80-mt ;
lib boost_regex : : <toolset>msvc <variant>debug <name>libboost_regex-vc80-mt-gd ;


